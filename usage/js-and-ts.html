<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/nimbus-shared/_next/static/css/f4a59790916c87b348ca.css" as="style"/><link rel="stylesheet" href="/nimbus-shared/_next/static/css/f4a59790916c87b348ca.css"/><link rel="preload" href="/nimbus-shared/_next/static/X13KAMCOdHxeyC_hK62hL/pages/_app.js" as="script"/><link rel="preload" href="/nimbus-shared/_next/static/X13KAMCOdHxeyC_hK62hL/pages/usage/js-and-ts.js" as="script"/><link rel="preload" href="/nimbus-shared/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/nimbus-shared/_next/static/chunks/framework.c6faae2799416a6da8e8.js" as="script"/><link rel="preload" href="/nimbus-shared/_next/static/chunks/ae038d516e55c33a1232dab3b9251f37a52ff320.36a881b4253e934d1e53.js" as="script"/><link rel="preload" href="/nimbus-shared/_next/static/runtime/main-aada38fcc83dc7ebd85a.js" as="script"/></head><body><div id="__next"><div class="wrapper"><div class="header-wrapper"><a class="header" href="/nimbus-shared/"><img src="/nimbus-shared/logo.svg" class="logo" width="40" height="40"/><h1>Project Nimbus Documentation</h1></a></div><nav class="site-nav"><ul><li><a class="">Home</a></li><h2>Using this library</h2><li><a class="current-page">JavaScript and TypeScript</a></li><li><a class="">Python</a></li><li><a class="">Other environments</a></li><h2>Contents</h2><li><a class="">Schemas</a></li><li><a class="">Data</a></li><h2>Working on this library</h2><li><a class="">Setup</a></li><li><a class="">Schemas</a></li><li><a class="">Data</a></li><li><a class="">Writing Docs</a></li><li><a class="">Deploying</a></li></ul></nav><main><h1>Using this library from JavaScript and TypeScript</h1><p>The schemas and data are published in the NPM package
<a href="https://www.npmjs.com/package/@mozilla/nimbus-shared"><code>@mozilla/nimbus-shared</code></a>. It contains helper
methods to validate data by the schemas, all of the schemas directly. For TypeScript, it also
includes the original type definitions and helpers for TypeScript usage, such as type assertions.</p><h2 class="anchoredHeadings_anchoredHeading__ojblp"><a class="anchoredHeadings_anchor__1xk1u anchoredHeadings_pullLeft__2NurG" href="#javascript" id="javascript" title="Permalink to this heading">#</a>JavaScript</h2><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> nimbus <span class="token keyword module">from</span> <span class="token string">&quot;@mozilla/nimbus-shared&quot;</span><span class="token punctuation">;</span>
</code></pre><p>JSON Schemas can be accessed in <code>nimbus.schemas</code>. Each schema group is an object under this export,
and the schemas are identified by their type name.</p><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token punctuation">{</span> schemas <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">&quot;@mozilla/nimbus-shared&quot;</span><span class="token punctuation">;</span>
schemas<span class="token punctuation">.</span><span class="token property-access">normandy</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">ConsoleLogArguments</span></span><span class="token punctuation">;</span>
<span class="token comment">// {&quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;, ...}</span>
</code></pre><p>Helper functions to validate objects against those schemas can be found in in the <code>typeGuards</code>
package export.</p><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token punctuation">{</span> typeGuards <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">&quot;@mozilla/nimbus-shared&quot;</span><span class="token punctuation">;</span>
typeGuards<span class="token punctuation">.</span><span class="token method function property-access">normandy_checkConsoleLogArguments</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
 * {
 *   ok: false,
 *   errors: [{message: &quot;should have required property &#x27;message&#x27;&quot;, ...}]
 * }
 */</span>

typeGuards<span class="token punctuation">.</span><span class="token method function property-access">normandy_checkConsoleLogArguments</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;It works!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
 * {
 *   ok: true,
 *   errors: []
 * }
 */</span>
</code></pre><p>Shared data can be accessed by importing <code>data</code> from the package:</p><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">&quot;@mozilla/nimbus-shared&quot;</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Audiences</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { all_english: { ... }, us_only: { ... }, ... }</span>
</code></pre><h2 class="anchoredHeadings_anchoredHeading__ojblp"><a class="anchoredHeadings_anchor__1xk1u anchoredHeadings_pullLeft__2NurG" href="#typescript" id="typescript" title="Permalink to this heading">#</a>TypeScript</h2><p>As well as everything available from JS, the original types the schemas are generated from are
available in the <code>types</code> export of the library. Additionally, well-typed guards and assertions are
available in <code>typeGuards</code>.</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> types<span class="token punctuation">,</span> typeGuards <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@mozilla/nimbus-shared&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> incomingJson<span class="token operator">:</span> object <span class="token operator">=</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;json from the server&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// incoming JSON is a generic object with no type information</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>typeGuards<span class="token punctuation">.</span><span class="token method function property-access">normandy_isConsoleLogArguments</span><span class="token punctuation">(</span>incomingJson<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// incomingJson has been narrowed to `types.normandy.ConsoleLogArguments</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// Something is wrong, and the types don&#x27;t match what we expected.</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> message<span class="token operator">:</span> types<span class="token punctuation">.</span><span class="token property-access">messaging</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">SimpleCFRMessage</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">&quot;incomplete-message&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Error: missing the following properties from type &#x27;SimpleCFRMessage&#x27;: template, trigger, content</span>

<span class="token keyword">const</span> userInput <span class="token operator">=</span> <span class="token punctuation">{</span> arbitrary<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
typeGuards<span class="token punctuation">.</span><span class="token method function property-access">normandy_assertAddonRollbackArguments</span><span class="token punctuation">(</span>userInput<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// userInput has now been asserted to be of type `normandy.AddonRollbackArguments`.</span>
<span class="token comment">// If it wasn&#x27;t the previous line would have thrown an error.</span>
</code></pre></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/usage/js-and-ts","query":{},"buildId":"X13KAMCOdHxeyC_hK62hL","assetPrefix":"/nimbus-shared","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/nimbus-shared/_next/static/runtime/polyfills-67e9f02528b459d8fde0.js"></script><script async="" data-next-page="/_app" src="/nimbus-shared/_next/static/X13KAMCOdHxeyC_hK62hL/pages/_app.js"></script><script async="" data-next-page="/usage/js-and-ts" src="/nimbus-shared/_next/static/X13KAMCOdHxeyC_hK62hL/pages/usage/js-and-ts.js"></script><script src="/nimbus-shared/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/nimbus-shared/_next/static/chunks/framework.c6faae2799416a6da8e8.js" async=""></script><script src="/nimbus-shared/_next/static/chunks/ae038d516e55c33a1232dab3b9251f37a52ff320.36a881b4253e934d1e53.js" async=""></script><script src="/nimbus-shared/_next/static/runtime/main-aada38fcc83dc7ebd85a.js" async=""></script><script src="/nimbus-shared/_next/static/X13KAMCOdHxeyC_hK62hL/_buildManifest.js" async=""></script><script src="/nimbus-shared/_next/static/X13KAMCOdHxeyC_hK62hL/_ssgManifest.js" async=""></script></body></html>